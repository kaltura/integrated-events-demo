"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.KalturaObjectBase = void 0;
var kaltura_client_utils_1 = require("./kaltura-client-utils");
var kaltura_types_factory_1 = require("./kaltura-types-factory");
var kaltura_logger_1 = require("./kaltura-logger");
;
var KalturaObjectBase = /** @class */ (function () {
    function KalturaObjectBase(data) {
        this._allowedEmptyArray = [];
        this._dependentProperties = {};
        if (data) {
            Object.assign(this, data);
        }
        if (typeof this.relatedObjects === 'undefined')
            this.relatedObjects = {};
    }
    KalturaObjectBase.prototype.allowEmptyArray = function () {
        var properties = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            properties[_i] = arguments[_i];
        }
        var metadata = this._getMetadata().properties;
        for (var _a = 0, properties_1 = properties; _a < properties_1.length; _a++) {
            var property = properties_1[_a];
            var metadataProperty = metadata[property];
            if (!metadataProperty) {
                kaltura_logger_1.Logger.debug("ignore property '".concat(property, "' flagged to allow empty array as it doesn't not exists on type (did you set the right property in method 'allowEmptyArray'?)"));
            }
            else if (metadataProperty.type !== 'a') {
                kaltura_logger_1.Logger.debug("ignore property '".concat(property, "' flagged to allow empty array as it is not of type array (did you set the right property in method 'allowEmptyArray'?)"));
            }
            else {
                this._allowedEmptyArray.push(property);
            }
        }
        return this;
    };
    KalturaObjectBase.prototype.setData = function (handler) {
        if (handler) {
            handler(this);
        }
        return this;
    };
    KalturaObjectBase.prototype.getTypeName = function () {
        return this._getMetadata().properties['objectType'].default;
    };
    KalturaObjectBase.prototype._getMetadata = function () {
        // DEVELOPER NOTICE: according to the server schema, property 'relatedObjects' should have be of type 'KalturaListResponse'.
        // this is not an option as it created circle reference where KalturaListResponse > KalturaObjectBase > KalturaListResponse.
        // Hence, we cannot set the type explicitly and we need to expose the default type 'KalturaObjectBase'
        return {
            properties: {
                relatedObjects: { type: 'm', readOnly: true, subTypeConstructor: null, subType: 'KalturaListResponse' },
            }
        };
    };
    KalturaObjectBase.prototype.hasMetadataProperty = function (propertyName) {
        return !!this._getMetadata().properties[propertyName];
    };
    KalturaObjectBase.prototype.toRequestObject = function () {
        var _this = this;
        var metadata = this._getMetadata();
        var result = {};
        try {
            Object.keys(metadata.properties).forEach(function (propertyName) {
                var propertyData = metadata.properties[propertyName];
                var propertyValue = _this._createRequestPropertyValue(propertyName, propertyData);
                switch (propertyValue.status) {
                    case "exists":
                        result[propertyName] = propertyValue.value;
                        break;
                    case "removed":
                        result["".concat(propertyName, "__null")] = ''; // mark property for deletion
                        break;
                    case "missing":
                    default:
                        break;
                }
            });
        }
        catch (err) {
            // TODO [kaltura] should use logHandler
            kaltura_logger_1.Logger.error(err.message);
            throw err;
        }
        return result;
    };
    KalturaObjectBase.prototype.fromResponseObject = function (data) {
        var _this = this;
        var metadata = this._getMetadata();
        var result = {};
        try {
            Object.keys(metadata.properties).forEach(function (propertyName) {
                var propertyData = metadata.properties[propertyName];
                var propertyValue = _this._parseResponseProperty(propertyName, propertyData, data);
                if (propertyValue != null && typeof propertyValue !== 'undefined') {
                    _this[propertyName] = propertyValue;
                }
            });
        }
        catch (err) {
            // TODO [kaltura] should use logHandler
            kaltura_logger_1.Logger.error(err.message);
            throw err;
        }
        return result;
    };
    KalturaObjectBase.prototype._parseResponseProperty = function (propertyName, property, source) {
        var _this = this;
        var result;
        var sourceValue = propertyName ? source[propertyName] : source;
        if (typeof sourceValue !== 'undefined') {
            if (sourceValue === null) {
                result = null;
            }
            else {
                switch (property.type) {
                    case 'b': // boolean
                        if (typeof sourceValue === 'boolean') {
                            result = sourceValue;
                        }
                        else if (sourceValue + '' === '0') {
                            result = false;
                        }
                        else if (sourceValue + '' === '1') {
                            result = true;
                        }
                        break;
                    case 's': // string
                        result = sourceValue + '';
                        break;
                    case 'n': // number
                    case 'en': // enum of type number
                        result = sourceValue * 1;
                        break;
                    case 'es': // enum of type number
                        result = typeof sourceValue !== 'undefined' && sourceValue !== null ? sourceValue.toString() : undefined;
                        break;
                    case 'o': // object
                        var propertyObjectType = sourceValue['objectType'];
                        if (propertyObjectType) {
                            result = this._createKalturaObject(propertyObjectType, property.subType);
                            if (result) {
                                result.fromResponseObject(sourceValue);
                            }
                            else {
                                throw new Error("Failed to create kaltura object of type '".concat(source['objectType'], "' (fallback type '").concat(property.subType, "')"));
                            }
                        }
                        else {
                            throw new Error("Failed to create kaltura object for property '".concat(propertyName, "' (type '").concat(property.subType, "'). provided response object is missing property 'objectType'."));
                        }
                        break;
                    case 'm': // map
                        var parsedMap_1 = {};
                        if (sourceValue instanceof Object) {
                            Object.keys(sourceValue).forEach(function (itemKey) {
                                var itemValue = sourceValue[itemKey];
                                var newItem = _this._createKalturaObject(itemValue['objectType'], property.subType);
                                if (itemValue && newItem) {
                                    newItem.fromResponseObject(itemValue);
                                    parsedMap_1[itemKey] = newItem;
                                }
                                else {
                                    throw new Error("Failed to create kaltura object for type '".concat(property.subType, "'"));
                                }
                            });
                            result = parsedMap_1;
                        }
                        else {
                            throw new Error("failed to parse property '".concat(propertyName, ". Expected type object, got type '").concat(typeof sourceValue));
                        }
                        break;
                    case 'a': // array
                        if (sourceValue instanceof Array) {
                            var parsedArray_1 = [];
                            sourceValue.forEach(function (responseItem) {
                                var newItem = _this._createKalturaObject(responseItem['objectType'], property.subType);
                                if (newItem) {
                                    newItem.fromResponseObject(responseItem);
                                    parsedArray_1.push(newItem);
                                }
                                else {
                                    throw new Error("Failed to create kaltura object for type '".concat(responseItem['objectType'], "' and for fallback type '").concat(property.subType, "'"));
                                }
                            });
                            result = parsedArray_1;
                        }
                        else {
                            throw new Error("failed to parse property '".concat(propertyName, ". Expected type array, got type '").concat(typeof sourceValue));
                        }
                        break;
                    case 'd': // date
                        if (this._isNumeric(sourceValue)) {
                            result = kaltura_client_utils_1.KalturaClientUtils.fromServerDate(sourceValue * 1);
                        }
                        else {
                            throw new Error("failed to parse property '".concat(propertyName, ". Expected type date, got type '").concat(typeof sourceValue));
                        }
                        break;
                    default:
                        break;
                }
            }
        }
        return result;
    };
    KalturaObjectBase.prototype._isNumeric = function (n) {
        return !isNaN(parseFloat(n)) && isFinite(n);
    };
    KalturaObjectBase.prototype._createKalturaObject = function (objectType, fallbackObjectType) {
        var result = null;
        var usedFallbackType = false;
        if (objectType) {
            result = kaltura_types_factory_1.KalturaTypesFactory.createObject(objectType);
        }
        if (!result && fallbackObjectType) {
            usedFallbackType = true;
            result = kaltura_types_factory_1.KalturaTypesFactory.createObject(fallbackObjectType);
        }
        if (usedFallbackType && result) {
            kaltura_logger_1.Logger.debug("could not find object type '".concat(objectType, "', Falling back to '").concat(fallbackObjectType, "' object type. (Did you remember to set your accepted object types in the request \u201Cconfig.acceptedTypes\u201D attribute?)"));
        }
        else if (!result) {
            kaltura_logger_1.Logger.debug("could not find object type '".concat(objectType, "'. (Did you remember to set your accepted object types in the request \u201Cconfig.acceptedTypes\u201D attribute?)"));
        }
        return result;
    };
    KalturaObjectBase.prototype._createRequestPropertyValue = function (propertyName, property) {
        var result = { status: 'missing' };
        if (property.type === 'c') {
            // constant string
            if (property.default) {
                result = { status: 'exists', value: property.default };
            }
        }
        else if (this._dependentProperties[propertyName]) {
            var dependentProperty = this._dependentProperties[propertyName];
            var resultValue = "{".concat(dependentProperty.request, ":result").concat(dependentProperty.targetPath ? ':' + dependentProperty.targetPath : '', "}");
            result = { status: 'exists', value: resultValue };
        }
        else if (!property.readOnly) {
            var value_1 = this[propertyName];
            if (typeof value_1 !== 'undefined') {
                if (value_1 === null) {
                    result = { status: 'removed' };
                }
                else {
                    switch (property.type) {
                        case 'b': // boolean
                            result = { status: 'exists', value: value_1 };
                            break;
                        case 's': // string
                            result = { status: 'exists', value: value_1 + '' };
                            break;
                        case 'n': // number
                        case 'en': // enum of type number
                            result = { status: 'exists', value: value_1 * 1 };
                            break;
                        case 'o': // object
                            if (value_1 instanceof KalturaObjectBase) {
                                result = { status: 'exists', value: value_1.toRequestObject() };
                            }
                            else {
                                throw new Error("failed to parse property. Expected '".concat(propertyName, " to be kaltura object"));
                            }
                            break;
                        case 'a': // array
                            if (value_1 instanceof Array) {
                                var parsedArray_2 = [];
                                value_1.forEach(function (item) {
                                    if (item instanceof KalturaObjectBase) {
                                        parsedArray_2.push(item.toRequestObject());
                                    }
                                });
                                var allowEmptyArrayAsAValue = this._allowedEmptyArray.indexOf(propertyName) !== -1;
                                if (allowEmptyArrayAsAValue || parsedArray_2.length !== 0) {
                                    if (parsedArray_2.length === value_1.length) {
                                        result = { status: 'exists', value: parsedArray_2 };
                                    }
                                    else {
                                        throw new Error("failed to parse array. Expected all '".concat(propertyName, " items to be kaltura object"));
                                    }
                                }
                            }
                            else {
                                throw new Error("failed to parse property. Expected '".concat(propertyName, " to be Array"));
                            }
                            break;
                        case 'm': //map
                            if (value_1 instanceof Object) {
                                var valueKeys = Object.keys(value_1);
                                if (valueKeys.length > 0) {
                                    var parsedObject_1 = {};
                                    valueKeys.forEach(function (itemKey) {
                                        var itemValue = value_1[itemKey];
                                        if (itemValue instanceof KalturaObjectBase) {
                                            parsedObject_1[itemKey] = itemValue.toRequestObject();
                                        }
                                    });
                                    if (valueKeys.length === Object.keys(parsedObject_1).length) {
                                        result = { status: 'exists', value: parsedObject_1 };
                                    }
                                    else {
                                        throw new Error("failed to parse map. Expected all '".concat(propertyName, " items to be kaltura object"));
                                    }
                                }
                            }
                            else {
                                throw new Error("failed to parse property. Expected '".concat(propertyName, " to be kaltura object"));
                            }
                            break;
                        case 'd': // date
                            if (value_1 instanceof Date) {
                                result = { status: 'exists', value: kaltura_client_utils_1.KalturaClientUtils.toServerDate(value_1) };
                            }
                            else {
                                throw new Error("failed to parse property. Expected '".concat(propertyName, " to be date"));
                            }
                            break;
                        case 'es': // enum of type string
                            result = { status: 'exists', value: typeof value_1 === 'string' ? value_1 : undefined };
                            break;
                        case 'f':
                            if (value_1 instanceof FormData) {
                                result = { status: 'exists', value: value_1 };
                            }
                            break;
                        default:
                            // do nothing
                            break;
                    }
                }
            }
        }
        return result;
    };
    KalturaObjectBase.prototype.setDependency = function () {
        var dependency = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            dependency[_i] = arguments[_i];
        }
        for (var i = 0, len = dependency.length; i < len; i++) {
            var item = dependency[i];
            var _a = item, property = _a.property, request = _a.request, targetPath = _a.targetPath;
            if (item instanceof Array) {
                property = item[0];
                request = item[1];
                targetPath = item.length === 3 ? item[2] : null;
            }
            // The server expect one based index (meaning the first item has index 1)
            // since Javascript array are zero based index we expose the api as zero based
            // and transform the index value in the actual request by adding 1
            request = request + 1;
            this._dependentProperties[property] = { property: property, request: request, targetPath: targetPath };
        }
        return this;
    };
    return KalturaObjectBase;
}());
exports.KalturaObjectBase = KalturaObjectBase;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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R0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3JELElBQU0sSUFBSSxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2QixJQUFBLEtBQXlDLElBQUksRUFBM0MsUUFBUSxjQUFBLEVBQUUsT0FBTyxhQUFBLEVBQUUsVUFBVSxnQkFBYyxDQUFDO1lBQ2xELElBQUksSUFBSSxZQUFZLEtBQUssRUFBRTtnQkFDekIsUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbkIsT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEIsVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQzthQUNqRDtZQUVELHlFQUF5RTtZQUN6RSw4RUFBOEU7WUFDOUUsa0VBQWtFO1lBQ2xFLE9BQU8sR0FBRyxPQUFPLEdBQUcsQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLFFBQVEsVUFBQSxFQUFFLE9BQU8sU0FBQSxFQUFFLFVBQVUsWUFBQSxFQUFFLENBQUM7U0FDekU7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFDSCx3QkFBQztBQUFELENBL1dBLEFBK1dDLElBQUE7QUEvV3FCLDhDQUFpQiIsImZpbGUiOiJhcGkva2FsdHVyYS1vYmplY3QtYmFzZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEthbHR1cmFDbGllbnRVdGlscyB9IGZyb20gXCIuL2thbHR1cmEtY2xpZW50LXV0aWxzXCI7XG5pbXBvcnQgeyBLYWx0dXJhVHlwZXNGYWN0b3J5IH0gZnJvbSAnLi9rYWx0dXJhLXR5cGVzLWZhY3RvcnknO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi9rYWx0dXJhLWxvZ2dlcidcblxuZXhwb3J0IHR5cGUgRGVwZW5kZW50UHJvcGVydHkgPSB7IHByb3BlcnR5OiBzdHJpbmcsIHJlcXVlc3Q6IG51bWJlciwgdGFyZ2V0UGF0aD86IHN0cmluZ1tdIH07XG5cbmV4cG9ydCBpbnRlcmZhY2UgS2FsdHVyYU9iamVjdE1ldGFkYXRhIHtcbiAgcHJvcGVydGllczogeyBba2V5OiBzdHJpbmddOiBLYWx0dXJhT2JqZWN0UHJvcGVydHlNZXRhZGF0YSB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEthbHR1cmFPYmplY3RQcm9wZXJ0eU1ldGFkYXRhIHtcbiAgcmVhZE9ubHk/OiBib29sZWFuO1xuICB0eXBlOiBzdHJpbmc7XG4gIHN1YlR5cGU/OiBzdHJpbmc7XG4gIGRlZmF1bHQ/OiBzdHJpbmc7XG4gIHN1YlR5cGVDb25zdHJ1Y3Rvcj86IHsgbmV3KCk6IEthbHR1cmFPYmplY3RCYXNlIH07XG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIEthbHR1cmFPYmplY3RCYXNlQXJncyB7XG4gIHJlbGF0ZWRPYmplY3RzPzogeyBba2V5OiBzdHJpbmddOiBLYWx0dXJhT2JqZWN0QmFzZSB9O1xufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgS2FsdHVyYU9iamVjdEJhc2Uge1xuXG4gIHByaXZhdGUgX2FsbG93ZWRFbXB0eUFycmF5OiBzdHJpbmdbXSA9IFtdO1xuICBwcml2YXRlIF9kZXBlbmRlbnRQcm9wZXJ0aWVzOiB7IFtrZXk6IHN0cmluZ106IERlcGVuZGVudFByb3BlcnR5IH0gPSB7fTtcbiAgcmVsYXRlZE9iamVjdHM6IHsgW2tleTogc3RyaW5nXTogS2FsdHVyYU9iamVjdEJhc2UgfTsgLy8gc2VlIGRldmVsb3BlciBub3RpY2UgaW4gbWV0aG9kICdfZ2V0TWV0YWRhdGEoKSdcblxuXG4gIGFsbG93RW1wdHlBcnJheSguLi5wcm9wZXJ0aWVzOiBzdHJpbmdbXSk6IHRoaXMge1xuICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5fZ2V0TWV0YWRhdGEoKS5wcm9wZXJ0aWVzO1xuICAgIGZvciAoY29uc3QgcHJvcGVydHkgb2YgcHJvcGVydGllcykge1xuICAgICAgY29uc3QgbWV0YWRhdGFQcm9wZXJ0eSA9IG1ldGFkYXRhW3Byb3BlcnR5XTtcbiAgICAgIGlmICghbWV0YWRhdGFQcm9wZXJ0eSkge1xuICAgICAgICBMb2dnZXIuZGVidWcoYGlnbm9yZSBwcm9wZXJ0eSAnJHtwcm9wZXJ0eX0nIGZsYWdnZWQgdG8gYWxsb3cgZW1wdHkgYXJyYXkgYXMgaXQgZG9lc24ndCBub3QgZXhpc3RzIG9uIHR5cGUgKGRpZCB5b3Ugc2V0IHRoZSByaWdodCBwcm9wZXJ0eSBpbiBtZXRob2QgJ2FsbG93RW1wdHlBcnJheSc/KWApXG4gICAgICB9IGVsc2UgaWYgKG1ldGFkYXRhUHJvcGVydHkudHlwZSAhPT0gJ2EnKSB7XG4gICAgICAgIExvZ2dlci5kZWJ1ZyhgaWdub3JlIHByb3BlcnR5ICcke3Byb3BlcnR5fScgZmxhZ2dlZCB0byBhbGxvdyBlbXB0eSBhcnJheSBhcyBpdCBpcyBub3Qgb2YgdHlwZSBhcnJheSAoZGlkIHlvdSBzZXQgdGhlIHJpZ2h0IHByb3BlcnR5IGluIG1ldGhvZCAnYWxsb3dFbXB0eUFycmF5Jz8pYClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2FsbG93ZWRFbXB0eUFycmF5LnB1c2gocHJvcGVydHkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2V0RGF0YShoYW5kbGVyOiAocmVxdWVzdDogdGhpcykgPT4gdm9pZCk6IHRoaXMge1xuICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICBoYW5kbGVyKHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGRhdGE/OiB7fSkge1xuICAgIGlmIChkYXRhKSB7XG4gICAgICBPYmplY3QuYXNzaWduKHRoaXMsIGRhdGEpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdGhpcy5yZWxhdGVkT2JqZWN0cyA9PT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVsYXRlZE9iamVjdHMgPSB7fTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRUeXBlTmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl9nZXRNZXRhZGF0YSgpLnByb3BlcnRpZXNbJ29iamVjdFR5cGUnXS5kZWZhdWx0O1xuICB9XG5cbiAgcHJvdGVjdGVkIF9nZXRNZXRhZGF0YSgpOiBLYWx0dXJhT2JqZWN0TWV0YWRhdGEge1xuICAgIC8vIERFVkVMT1BFUiBOT1RJQ0U6IGFjY29yZGluZyB0byB0aGUgc2VydmVyIHNjaGVtYSwgcHJvcGVydHkgJ3JlbGF0ZWRPYmplY3RzJyBzaG91bGQgaGF2ZSBiZSBvZiB0eXBlICdLYWx0dXJhTGlzdFJlc3BvbnNlJy5cbiAgICAvLyB0aGlzIGlzIG5vdCBhbiBvcHRpb24gYXMgaXQgY3JlYXRlZCBjaXJjbGUgcmVmZXJlbmNlIHdoZXJlIEthbHR1cmFMaXN0UmVzcG9uc2UgPiBLYWx0dXJhT2JqZWN0QmFzZSA+IEthbHR1cmFMaXN0UmVzcG9uc2UuXG4gICAgLy8gSGVuY2UsIHdlIGNhbm5vdCBzZXQgdGhlIHR5cGUgZXhwbGljaXRseSBhbmQgd2UgbmVlZCB0byBleHBvc2UgdGhlIGRlZmF1bHQgdHlwZSAnS2FsdHVyYU9iamVjdEJhc2UnXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgcmVsYXRlZE9iamVjdHM6IHsgdHlwZTogJ20nLCByZWFkT25seTogdHJ1ZSwgc3ViVHlwZUNvbnN0cnVjdG9yOiBudWxsLCBzdWJUeXBlOiAnS2FsdHVyYUxpc3RSZXNwb25zZScgfSxcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGhhc01ldGFkYXRhUHJvcGVydHkocHJvcGVydHlOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISF0aGlzLl9nZXRNZXRhZGF0YSgpLnByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcbiAgfVxuXG4gIHRvUmVxdWVzdE9iamVjdCgpOiB7fSB7XG4gICAgY29uc3QgbWV0YWRhdGEgPSB0aGlzLl9nZXRNZXRhZGF0YSgpO1xuICAgIGxldCByZXN1bHQgPSB7fTtcblxuICAgIHRyeSB7XG4gICAgICBPYmplY3Qua2V5cyhtZXRhZGF0YS5wcm9wZXJ0aWVzKS5mb3JFYWNoKHByb3BlcnR5TmFtZSA9PiB7XG4gICAgICAgIGNvbnN0IHByb3BlcnR5RGF0YSA9IG1ldGFkYXRhLnByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcbiAgICAgICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IHRoaXMuX2NyZWF0ZVJlcXVlc3RQcm9wZXJ0eVZhbHVlKHByb3BlcnR5TmFtZSwgcHJvcGVydHlEYXRhKTtcblxuICAgICAgICBzd2l0Y2ggKHByb3BlcnR5VmFsdWUuc3RhdHVzKSB7XG4gICAgICAgICAgY2FzZSBcImV4aXN0c1wiOlxuICAgICAgICAgICAgcmVzdWx0W3Byb3BlcnR5TmFtZV0gPSBwcm9wZXJ0eVZhbHVlLnZhbHVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcInJlbW92ZWRcIjpcbiAgICAgICAgICAgIHJlc3VsdFtgJHtwcm9wZXJ0eU5hbWV9X19udWxsYF0gPSAnJzsgLy8gbWFyayBwcm9wZXJ0eSBmb3IgZGVsZXRpb25cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJtaXNzaW5nXCI6XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIFRPRE8gW2thbHR1cmFdIHNob3VsZCB1c2UgbG9nSGFuZGxlclxuICAgICAgTG9nZ2VyLmVycm9yKGVyci5tZXNzYWdlKVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmcm9tUmVzcG9uc2VPYmplY3QoZGF0YTogYW55KToge30ge1xuICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5fZ2V0TWV0YWRhdGEoKTtcbiAgICBsZXQgcmVzdWx0ID0ge307XG5cbiAgICB0cnkge1xuICAgICAgT2JqZWN0LmtleXMobWV0YWRhdGEucHJvcGVydGllcykuZm9yRWFjaChwcm9wZXJ0eU5hbWUgPT4ge1xuICAgICAgICBjb25zdCBwcm9wZXJ0eURhdGEgPSBtZXRhZGF0YS5wcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XG4gICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSB0aGlzLl9wYXJzZVJlc3BvbnNlUHJvcGVydHkocHJvcGVydHlOYW1lLCBwcm9wZXJ0eURhdGEsIGRhdGEpO1xuXG4gICAgICAgIGlmIChwcm9wZXJ0eVZhbHVlICE9IG51bGwgJiYgdHlwZW9mIHByb3BlcnR5VmFsdWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgdGhpc1twcm9wZXJ0eU5hbWVdID0gcHJvcGVydHlWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAvLyBUT0RPIFtrYWx0dXJhXSBzaG91bGQgdXNlIGxvZ0hhbmRsZXJcbiAgICAgIExvZ2dlci5lcnJvcihlcnIubWVzc2FnZSlcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cblxuXG4gIHByb3RlY3RlZCBfcGFyc2VSZXNwb25zZVByb3BlcnR5KHByb3BlcnR5TmFtZTogc3RyaW5nLCBwcm9wZXJ0eTogS2FsdHVyYU9iamVjdFByb3BlcnR5TWV0YWRhdGEsIHNvdXJjZTogYW55KTogYW55IHtcblxuICAgIGxldCByZXN1bHQ7XG4gICAgbGV0IHNvdXJjZVZhbHVlID0gcHJvcGVydHlOYW1lID8gc291cmNlW3Byb3BlcnR5TmFtZV0gOiBzb3VyY2U7XG5cbiAgICBpZiAodHlwZW9mIHNvdXJjZVZhbHVlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgaWYgKHNvdXJjZVZhbHVlID09PSBudWxsKSB7XG4gICAgICAgIHJlc3VsdCA9IG51bGw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzd2l0Y2ggKHByb3BlcnR5LnR5cGUpIHtcbiAgICAgICAgICBjYXNlICdiJzogLy8gYm9vbGVhblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzb3VyY2VWYWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgIHJlc3VsdCA9IHNvdXJjZVZhbHVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzb3VyY2VWYWx1ZSArICcnID09PSAnMCcpIHtcbiAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNvdXJjZVZhbHVlICsgJycgPT09ICcxJykge1xuICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAncyc6IC8vIHN0cmluZ1xuICAgICAgICAgICAgcmVzdWx0ID0gc291cmNlVmFsdWUgKyAnJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ24nOiAvLyBudW1iZXJcbiAgICAgICAgICBjYXNlICdlbic6IC8vIGVudW0gb2YgdHlwZSBudW1iZXJcbiAgICAgICAgICAgIHJlc3VsdCA9IHNvdXJjZVZhbHVlICogMTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ2VzJzogLy8gZW51bSBvZiB0eXBlIG51bWJlclxuICAgICAgICAgICAgcmVzdWx0ID0gdHlwZW9mIHNvdXJjZVZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiBzb3VyY2VWYWx1ZSAhPT0gbnVsbCA/IHNvdXJjZVZhbHVlLnRvU3RyaW5nKCkgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdvJzogLy8gb2JqZWN0XG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eU9iamVjdFR5cGUgPSBzb3VyY2VWYWx1ZVsnb2JqZWN0VHlwZSddO1xuXG4gICAgICAgICAgICBpZiAocHJvcGVydHlPYmplY3RUeXBlKSB7XG4gICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuX2NyZWF0ZUthbHR1cmFPYmplY3QocHJvcGVydHlPYmplY3RUeXBlLCBwcm9wZXJ0eS5zdWJUeXBlKTtcblxuICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmZyb21SZXNwb25zZU9iamVjdChzb3VyY2VWYWx1ZSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gY3JlYXRlIGthbHR1cmEgb2JqZWN0IG9mIHR5cGUgJyR7c291cmNlWydvYmplY3RUeXBlJ119JyAoZmFsbGJhY2sgdHlwZSAnJHtwcm9wZXJ0eS5zdWJUeXBlfScpYCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBrYWx0dXJhIG9iamVjdCBmb3IgcHJvcGVydHkgJyR7cHJvcGVydHlOYW1lfScgKHR5cGUgJyR7cHJvcGVydHkuc3ViVHlwZX0nKS4gcHJvdmlkZWQgcmVzcG9uc2Ugb2JqZWN0IGlzIG1pc3NpbmcgcHJvcGVydHkgJ29iamVjdFR5cGUnLmApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdtJzogLy8gbWFwXG4gICAgICAgICAgICBjb25zdCBwYXJzZWRNYXAgPSB7fTtcbiAgICAgICAgICAgIGlmIChzb3VyY2VWYWx1ZSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICAgICAgICBPYmplY3Qua2V5cyhzb3VyY2VWYWx1ZSkuZm9yRWFjaChpdGVtS2V5ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtVmFsdWUgPSBzb3VyY2VWYWx1ZVtpdGVtS2V5XTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdJdGVtID0gdGhpcy5fY3JlYXRlS2FsdHVyYU9iamVjdChpdGVtVmFsdWVbJ29iamVjdFR5cGUnXSwgcHJvcGVydHkuc3ViVHlwZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbVZhbHVlICYmIG5ld0l0ZW0pIHtcbiAgICAgICAgICAgICAgICAgIG5ld0l0ZW0uZnJvbVJlc3BvbnNlT2JqZWN0KGl0ZW1WYWx1ZSk7XG4gICAgICAgICAgICAgICAgICBwYXJzZWRNYXBbaXRlbUtleV0gPSBuZXdJdGVtO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBjcmVhdGUga2FsdHVyYSBvYmplY3QgZm9yIHR5cGUgJyR7cHJvcGVydHkuc3ViVHlwZX0nYCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIHJlc3VsdCA9IHBhcnNlZE1hcDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZmFpbGVkIHRvIHBhcnNlIHByb3BlcnR5ICcke3Byb3BlcnR5TmFtZX0uIEV4cGVjdGVkIHR5cGUgb2JqZWN0LCBnb3QgdHlwZSAnJHt0eXBlb2Ygc291cmNlVmFsdWV9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdhJzogLy8gYXJyYXlcbiAgICAgICAgICAgIGlmIChzb3VyY2VWYWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgIGNvbnN0IHBhcnNlZEFycmF5ID0gW107XG4gICAgICAgICAgICAgIHNvdXJjZVZhbHVlLmZvckVhY2gocmVzcG9uc2VJdGVtID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdJdGVtID0gdGhpcy5fY3JlYXRlS2FsdHVyYU9iamVjdChyZXNwb25zZUl0ZW1bJ29iamVjdFR5cGUnXSwgcHJvcGVydHkuc3ViVHlwZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAobmV3SXRlbSkge1xuICAgICAgICAgICAgICAgICAgbmV3SXRlbS5mcm9tUmVzcG9uc2VPYmplY3QocmVzcG9uc2VJdGVtKTtcbiAgICAgICAgICAgICAgICAgIHBhcnNlZEFycmF5LnB1c2gobmV3SXRlbSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBrYWx0dXJhIG9iamVjdCBmb3IgdHlwZSAnJHtyZXNwb25zZUl0ZW1bJ29iamVjdFR5cGUnXX0nIGFuZCBmb3IgZmFsbGJhY2sgdHlwZSAnJHtwcm9wZXJ0eS5zdWJUeXBlfSdgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIHJlc3VsdCA9IHBhcnNlZEFycmF5O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBmYWlsZWQgdG8gcGFyc2UgcHJvcGVydHkgJyR7cHJvcGVydHlOYW1lfS4gRXhwZWN0ZWQgdHlwZSBhcnJheSwgZ290IHR5cGUgJyR7dHlwZW9mIHNvdXJjZVZhbHVlfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnZCc6IC8vIGRhdGVcbiAgICAgICAgICAgIGlmICh0aGlzLl9pc051bWVyaWMoc291cmNlVmFsdWUpKSB7XG4gICAgICAgICAgICAgIHJlc3VsdCA9IEthbHR1cmFDbGllbnRVdGlscy5mcm9tU2VydmVyRGF0ZShzb3VyY2VWYWx1ZSAqIDEpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGZhaWxlZCB0byBwYXJzZSBwcm9wZXJ0eSAnJHtwcm9wZXJ0eU5hbWV9LiBFeHBlY3RlZCB0eXBlIGRhdGUsIGdvdCB0eXBlICcke3R5cGVvZiBzb3VyY2VWYWx1ZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHByaXZhdGUgX2lzTnVtZXJpYyhuOiBhbnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIWlzTmFOKHBhcnNlRmxvYXQobikpICYmIGlzRmluaXRlKG4pO1xuICB9XG5cbiAgcHJpdmF0ZSBfY3JlYXRlS2FsdHVyYU9iamVjdChvYmplY3RUeXBlOiBzdHJpbmcsIGZhbGxiYWNrT2JqZWN0VHlwZT86IHN0cmluZyk6IEthbHR1cmFPYmplY3RCYXNlIHtcbiAgICBsZXQgcmVzdWx0ID0gbnVsbDtcbiAgICBsZXQgdXNlZEZhbGxiYWNrVHlwZSA9IGZhbHNlO1xuICAgIGlmIChvYmplY3RUeXBlKSB7XG4gICAgICByZXN1bHQgPSBLYWx0dXJhVHlwZXNGYWN0b3J5LmNyZWF0ZU9iamVjdChvYmplY3RUeXBlKTtcbiAgICB9XG5cbiAgICBpZiAoIXJlc3VsdCAmJiBmYWxsYmFja09iamVjdFR5cGUpIHtcbiAgICAgIHVzZWRGYWxsYmFja1R5cGUgPSB0cnVlO1xuICAgICAgcmVzdWx0ID0gS2FsdHVyYVR5cGVzRmFjdG9yeS5jcmVhdGVPYmplY3QoZmFsbGJhY2tPYmplY3RUeXBlKTtcbiAgICB9XG5cbiAgICBpZiAodXNlZEZhbGxiYWNrVHlwZSAmJiByZXN1bHQpIHtcbiAgICAgIExvZ2dlci5kZWJ1ZyhgY291bGQgbm90IGZpbmQgb2JqZWN0IHR5cGUgJyR7b2JqZWN0VHlwZX0nLCBGYWxsaW5nIGJhY2sgdG8gJyR7ZmFsbGJhY2tPYmplY3RUeXBlfScgb2JqZWN0IHR5cGUuIChEaWQgeW91IHJlbWVtYmVyIHRvIHNldCB5b3VyIGFjY2VwdGVkIG9iamVjdCB0eXBlcyBpbiB0aGUgcmVxdWVzdCDigJxjb25maWcuYWNjZXB0ZWRUeXBlc+KAnSBhdHRyaWJ1dGU/KWApXG4gICAgfSBlbHNlIGlmICghcmVzdWx0KSB7XG4gICAgICBMb2dnZXIuZGVidWcoYGNvdWxkIG5vdCBmaW5kIG9iamVjdCB0eXBlICcke29iamVjdFR5cGV9Jy4gKERpZCB5b3UgcmVtZW1iZXIgdG8gc2V0IHlvdXIgYWNjZXB0ZWQgb2JqZWN0IHR5cGVzIGluIHRoZSByZXF1ZXN0IOKAnGNvbmZpZy5hY2NlcHRlZFR5cGVz4oCdIGF0dHJpYnV0ZT8pYClcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJpdmF0ZSBfY3JlYXRlUmVxdWVzdFByb3BlcnR5VmFsdWUocHJvcGVydHlOYW1lOiBzdHJpbmcsIHByb3BlcnR5OiBLYWx0dXJhT2JqZWN0UHJvcGVydHlNZXRhZGF0YSk6IHsgc3RhdHVzOiAnbWlzc2luZycgfCAncmVtb3ZlZCcgfCAnZXhpc3RzJywgdmFsdWU/OiBhbnkgfSB7XG5cbiAgICBsZXQgcmVzdWx0OiB7IHN0YXR1czogJ21pc3NpbmcnIHwgJ3JlbW92ZWQnIHwgJ2V4aXN0cycsIHZhbHVlPzogYW55IH0gPSB7IHN0YXR1czogJ21pc3NpbmcnIH07XG5cbiAgICBpZiAocHJvcGVydHkudHlwZSA9PT0gJ2MnKSB7XG4gICAgICAvLyBjb25zdGFudCBzdHJpbmdcbiAgICAgIGlmIChwcm9wZXJ0eS5kZWZhdWx0KSB7XG4gICAgICAgIHJlc3VsdCA9IHsgc3RhdHVzOiAnZXhpc3RzJywgdmFsdWU6IHByb3BlcnR5LmRlZmF1bHQgfTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuX2RlcGVuZGVudFByb3BlcnRpZXNbcHJvcGVydHlOYW1lXSkge1xuICAgICAgY29uc3QgZGVwZW5kZW50UHJvcGVydHkgPSB0aGlzLl9kZXBlbmRlbnRQcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XG4gICAgICBjb25zdCByZXN1bHRWYWx1ZSA9IGB7JHtkZXBlbmRlbnRQcm9wZXJ0eS5yZXF1ZXN0fTpyZXN1bHQke2RlcGVuZGVudFByb3BlcnR5LnRhcmdldFBhdGggPyAnOicgKyBkZXBlbmRlbnRQcm9wZXJ0eS50YXJnZXRQYXRoIDogJyd9fWA7XG4gICAgICByZXN1bHQgPSB7IHN0YXR1czogJ2V4aXN0cycsIHZhbHVlOiByZXN1bHRWYWx1ZSB9O1xuICAgIH1cbiAgICBlbHNlIGlmICghcHJvcGVydHkucmVhZE9ubHkpIHtcbiAgICAgIGxldCB2YWx1ZSA9IHRoaXNbcHJvcGVydHlOYW1lXTtcblxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgcmVzdWx0ID0geyBzdGF0dXM6ICdyZW1vdmVkJyB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN3aXRjaCAocHJvcGVydHkudHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnYic6IC8vIGJvb2xlYW5cbiAgICAgICAgICAgICAgcmVzdWx0ID0geyBzdGF0dXM6ICdleGlzdHMnLCB2YWx1ZTogdmFsdWUgfTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzJzogLy8gc3RyaW5nXG4gICAgICAgICAgICAgIHJlc3VsdCA9IHsgc3RhdHVzOiAnZXhpc3RzJywgdmFsdWU6IHZhbHVlICsgJycgfTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICduJzogLy8gbnVtYmVyXG4gICAgICAgICAgICBjYXNlICdlbic6IC8vIGVudW0gb2YgdHlwZSBudW1iZXJcbiAgICAgICAgICAgICAgcmVzdWx0ID0geyBzdGF0dXM6ICdleGlzdHMnLCB2YWx1ZTogdmFsdWUgKiAxIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbyc6IC8vIG9iamVjdFxuICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBLYWx0dXJhT2JqZWN0QmFzZSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHsgc3RhdHVzOiAnZXhpc3RzJywgdmFsdWU6IHZhbHVlLnRvUmVxdWVzdE9iamVjdCgpIH07XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBmYWlsZWQgdG8gcGFyc2UgcHJvcGVydHkuIEV4cGVjdGVkICcke3Byb3BlcnR5TmFtZX0gdG8gYmUga2FsdHVyYSBvYmplY3RgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2EnOiAvLyBhcnJheVxuICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZEFycmF5ID0gW107XG4gICAgICAgICAgICAgICAgdmFsdWUuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgS2FsdHVyYU9iamVjdEJhc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VkQXJyYXkucHVzaChpdGVtLnRvUmVxdWVzdE9iamVjdCgpKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbG93RW1wdHlBcnJheUFzQVZhbHVlID0gdGhpcy5fYWxsb3dlZEVtcHR5QXJyYXkuaW5kZXhPZihwcm9wZXJ0eU5hbWUpICE9PSAtMTtcbiAgICAgICAgICAgICAgICBpZiAoYWxsb3dFbXB0eUFycmF5QXNBVmFsdWUgfHwgcGFyc2VkQXJyYXkubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICBpZiAocGFyc2VkQXJyYXkubGVuZ3RoID09PSB2YWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0geyBzdGF0dXM6ICdleGlzdHMnLCB2YWx1ZTogcGFyc2VkQXJyYXkgfTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZmFpbGVkIHRvIHBhcnNlIGFycmF5LiBFeHBlY3RlZCBhbGwgJyR7cHJvcGVydHlOYW1lfSBpdGVtcyB0byBiZSBrYWx0dXJhIG9iamVjdGApO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGZhaWxlZCB0byBwYXJzZSBwcm9wZXJ0eS4gRXhwZWN0ZWQgJyR7cHJvcGVydHlOYW1lfSB0byBiZSBBcnJheWApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbSc6IC8vbWFwXG4gICAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlS2V5cyA9IE9iamVjdC5rZXlzKHZhbHVlKTtcblxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZUtleXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgY29uc3QgcGFyc2VkT2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgICB2YWx1ZUtleXMuZm9yRWFjaChpdGVtS2V5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1WYWx1ZSA9IHZhbHVlW2l0ZW1LZXldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVZhbHVlIGluc3RhbmNlb2YgS2FsdHVyYU9iamVjdEJhc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICBwYXJzZWRPYmplY3RbaXRlbUtleV0gPSBpdGVtVmFsdWUudG9SZXF1ZXN0T2JqZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZUtleXMubGVuZ3RoID09PSBPYmplY3Qua2V5cyhwYXJzZWRPYmplY3QpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB7IHN0YXR1czogJ2V4aXN0cycsIHZhbHVlOiBwYXJzZWRPYmplY3QgfTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZmFpbGVkIHRvIHBhcnNlIG1hcC4gRXhwZWN0ZWQgYWxsICcke3Byb3BlcnR5TmFtZX0gaXRlbXMgdG8gYmUga2FsdHVyYSBvYmplY3RgKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBmYWlsZWQgdG8gcGFyc2UgcHJvcGVydHkuIEV4cGVjdGVkICcke3Byb3BlcnR5TmFtZX0gdG8gYmUga2FsdHVyYSBvYmplY3RgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2QnOiAvLyBkYXRlXG4gICAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB7IHN0YXR1czogJ2V4aXN0cycsIHZhbHVlOiBLYWx0dXJhQ2xpZW50VXRpbHMudG9TZXJ2ZXJEYXRlKHZhbHVlKSB9O1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZmFpbGVkIHRvIHBhcnNlIHByb3BlcnR5LiBFeHBlY3RlZCAnJHtwcm9wZXJ0eU5hbWV9IHRvIGJlIGRhdGVgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2VzJzogLy8gZW51bSBvZiB0eXBlIHN0cmluZ1xuICAgICAgICAgICAgICByZXN1bHQgPSB7IHN0YXR1czogJ2V4aXN0cycsIHZhbHVlOiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gdmFsdWUgOiB1bmRlZmluZWQgfTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdmJzpcbiAgICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRm9ybURhdGEpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB7IHN0YXR1czogJ2V4aXN0cycsIHZhbHVlOiB2YWx1ZSB9O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgLy8gZG8gbm90aGluZ1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgc2V0RGVwZW5kZW5jeSguLi5kZXBlbmRlbmN5OiAoRGVwZW5kZW50UHJvcGVydHkgfCBbc3RyaW5nLCBudW1iZXJdIHwgW3N0cmluZywgbnVtYmVyLCBzdHJpbmddKVtdKTogdGhpcyB7XG4gICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGRlcGVuZGVuY3kubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBkZXBlbmRlbmN5W2ldO1xuICAgICAgbGV0IHsgcHJvcGVydHksIHJlcXVlc3QsIHRhcmdldFBhdGggfSA9IDxhbnk+aXRlbTtcbiAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgcHJvcGVydHkgPSBpdGVtWzBdO1xuICAgICAgICByZXF1ZXN0ID0gaXRlbVsxXTtcbiAgICAgICAgdGFyZ2V0UGF0aCA9IGl0ZW0ubGVuZ3RoID09PSAzID8gaXRlbVsyXSA6IG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIFRoZSBzZXJ2ZXIgZXhwZWN0IG9uZSBiYXNlZCBpbmRleCAobWVhbmluZyB0aGUgZmlyc3QgaXRlbSBoYXMgaW5kZXggMSlcbiAgICAgIC8vIHNpbmNlIEphdmFzY3JpcHQgYXJyYXkgYXJlIHplcm8gYmFzZWQgaW5kZXggd2UgZXhwb3NlIHRoZSBhcGkgYXMgemVybyBiYXNlZFxuICAgICAgLy8gYW5kIHRyYW5zZm9ybSB0aGUgaW5kZXggdmFsdWUgaW4gdGhlIGFjdHVhbCByZXF1ZXN0IGJ5IGFkZGluZyAxXG4gICAgICByZXF1ZXN0ID0gcmVxdWVzdCArIDE7XG4gICAgICB0aGlzLl9kZXBlbmRlbnRQcm9wZXJ0aWVzW3Byb3BlcnR5XSA9IHsgcHJvcGVydHksIHJlcXVlc3QsIHRhcmdldFBhdGggfTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuIl19
